Puntos a abordar

- mencionar realizabilidad clásica. Related work capaz en la conclusión
- hacer una investigación de otras formas de hacer witness extraction. Capaz no es original lo nuestro (y capaz Coq lo banca con realizabilidad).

\begin{itemize}
    \item Motivación, limitaciones de lógica clásica. Demostración sqrt 2
    \item Lógica intuicionista
    \item Como necesitamos reducir en ND, necesitamos la demo en ND. Escribirla
    en este caso.
    \item También queremos para $\piZeroTwo$, mostrar la extensión en ND.
    \item En realidad no nos sirve $\transDNeg{\Gamma}$, queremos dejarlo como
    está y demostrar que los axiomas demuestran sus traducciones. Pero no vale
    siempre (buscar c.ej), caracterizar cuando.
    \item Sumarizar cómo queda, vincular con reducción. Mostrar ejemplos en PPA
    que funcionan y ejemplos que no.
    \item Extensión a demostraciones. Mostrar algunos ejemplos interesantes (y
    los que usen los lemas dNegRElim y rElim)
    \item Lemas para demostraciones: dNegRElim (relacionar con \ref{ppa-cert:sec:abs-reasoning}), rElim, tNegRElim
    \item Reducción (buena explicación
    \url{https://plato.stanford.edu/entries/natural-deduction/}). En realidad se
    conoce como \textbf{normalization}.
    \begin{itemize}
        \item Similitud con reducción en cálculo lambda.
        \item Ejemplos de LP y todo LPO
        \item substHyp, substVar en proofs
        \item Argumentos de que es correcto y completo?
        \item Small step vs big step
    \end{itemize}
\end{itemize}

\newpage

En los capítulos anteriores vimos como el lenguaje PPA puede ser usado para
escribir demostraciones de alto nivel, que son certificadas generando
demostraciones de bajo nivel usando el sistema lógico de deducción natural.
Ahora vamos a introducir una nueva funcionalidad: la \textbf{extracción de testigos}.

\begin{multicols}{2}
    \begin{figure}[H]
        \lstinputlisting{listings/extract/exists.ppa}
        \caption{Extracción simple}
        \label{fri:prog:exists}
    \end{figure}

    \begin{figure}[H]
        \lstinputlisting{listings/extract/forall.ppa}
        \caption{Extracción con instanciación}
        \label{fri:prog:forall}
    \end{figure}
    \begin{figure}[H]
        \lstinputlisting[firstline=2]{listings/extract/indirect.ppa}
        \caption{Extracción indirecta}
        \label{fri:prog:indirect}
    \end{figure}
\end{multicols}

Por ejemplo, en el programa \fullref{fri:prog:exists} la extracción nos
permitirá encontrar un término $t$ que sea testigo de $\exists x. p(x)$, es
decir que cumpla $p(t)$. En este caso es fácil encontrarlo a ojo sobre la
demostración de PPA, sería \lstinline{v}. Pero puede haber casos en donde no sea
tan trivial, como en el programa \fullref{fri:prog:indirect}, en donde se
instancia la variable en un término de forma indirecta. Además, también
querríamos poder extraer en casos donde haya cuantificadores universales, como
en \fullref{fri:prog:forall}. Buscamos un mecanismo general, que nos permita a
partir de cualquier demostración una fórmula de la pinta $\forall \var_0 \dots
\forall \var_n \exists \varTwo . \alpha$ extraer un testigo. Vamos a hacerlo a
partir de los certificados de deducción natural.

\section{Otros métodos de extracción}

\todo{Hablar sobre y citar classical realizability, no tengo ni idea.}

\section{La lógica clásica no es constructiva}

El objetivo es extraer el testigo de las demostraciones generadas por el
certificador, pero estas son en lógica clásica, que tiene el gran problema de
que en general, \textbf{no es constructiva}. ¿Qué quiere decir? Que en general,
puede suceder que una demostración de $\exists x . p(x)$ no nos diga quien es
$x$, y por lo tanto no podamos extraer un testigo. Esto es porque en la lógica
clásica vale el \textit{principio del tercero excluido} o LEM

\begin{prop}[LEM] Para toda fórmula $\form$, es verdadera ella o su negación
    \[ \form \vee \neg \form \]
\end{prop}

Las demostraciones que usan este principio suelen dejar aspectos sin
concretizar, como muestra el siguiente ejemplo bien conocido:

\begin{theorem}\label{fri:thm:irrat}
    Existen dos números irracionales, $a, b$ tales que $a^b$ es irracional
\end{theorem}
\begin{proof}
    Considerar el número $\sqrt{2}^{\sqrt{2}}$. Por LEM, es o bien racional o
    irracional.
    \begin{itemize}
        \item Supongamos que es racional. Como sabemos que $\sqrt{2}$ es
        irracional, podemos tomar $a=b=\sqrt{2}$.
        \item Supongamos que es irracional. Tomamos $a = \sqrt{2}^{\sqrt{2}}, b
        = \sqrt{2}$. Ambos son irracionales, y tenemos

        \[
            a^b
            = \left( \sqrt{2}^{\sqrt{2}} \right)^{\sqrt{2}}
            = \sqrt{2}^{\sqrt{2} \cdot \sqrt{2}}
            = \sqrt{2}^{2}
            = 2,
        \]

        que es racional.
    \end{itemize}
\end{proof}

La prueba no nos da forma de saber cuales son $a$ y $b$. Es por eso que en
general, en lógica clásica, tener una demostración de un teorema que afirma la
existencia de un objeto que cumpla cierta propiedad, no necesariamente nos da
una forma de encontrar tal objeto. Entonces tampoco vamos a poder extraer un
testigo.

En el caso de \fullref{fri:thm:irrat} elegimos demostrarlo de forma no
constructiva, pero existen formas constructivas de hacerlo \todo{citation
needed}. Pero hay casos en donde no.

\begin{ejemplo}[Demostración no constructiva]
    Si consideramos la fórmula
    \[
        \exists x . ((x = 1 \wedge C) \vee (x = 0 \wedge \neg C))
    \]
    y pensamos en $C$ como algo indecidible, por ejemplo \texttt{HALT},
    trivialmente podemos demostrarlo de forma no constructiva (LEM con $C \vee
    \neg C$) pero nunca de forma constructiva.
\end{ejemplo}

\section{Lógica intuicionista}

Como alternativa a la lógica clásica existe existe la lógica
\textbf{intuicionista}, que se puede definir como la lógica clásica sin LEM. Al
no contar con ese principio, las demostraciones son constructivas. Esto permite
por un lado tener interpretaciones computacionales (como la \textit{BHK}) y
además que exista la noción de \textit{forma normal} de una demostración.
Existen métodos bien conocidos para reducir prueba hacia su forma normal con un
proceso análogo a una reducción de cálculo $\lambda$. 

Esto permite usar como estrategia de extracción la siguiente: normalizar la
demostración y obtener el testigo de la forma normal. En ella, se esperaría que
toda demostración de un $\exists$ sea mediante \ruleExistsI{}, explicitando el
testigo.

Al no tener LEM, tampoco valen principios de razonamiento clásicos equivalentes,
como la eliminación de la doble negación.

\section{Traducción de Friedman}

Queremos extraer testigos de las demostraciones generadas por el certificador de
PPA, pero son en lógica clásica. Sabemos que podemos hacerlo para lógica
intuicionista. ¿Cómo conciliamos ambos mundos?

\subsection{Traducción de doble negación}

Existen muchos métodos que permiten embeber la lógica clásica en la
intuicionista \todo{citar}. Un mecanismo general es la traducción de
\textbf{doble negación}, que intuitivamente consiste en agregar una doble
negación recursivamente a toda la fórmula. Por ejemplo

\newcommand{\gN}[1]{#1^{\text{N}}}

\begin{definition}[Traducción \textit{Gödel-Gentzen}] Dada una fórmula $\form$ se asocia con otra $\gN{\form}$. La
    traducción se define por inducción estructural.

    \begin{align*}
        \gN{\fFalse} &= \fFalse\\
        \gN{\fTrue} &= \fTrue\\
        \gN{\form} &= \neg\neg \form \quad \text{con $\form \neq \fFalse$ atómica}\\
        \gN{(\form \wedge \formTwo)} &= \gN{\form} \wedge \gN{\formTwo}\\
        \gN{(\form \vee \formTwo)} &= \neg(\neg\gN{\form} \wedge \neg\gN{\formTwo})\\
        \gN{(\form \rightarrow \formTwo)} &= \gN{\form} \rightarrow \gN{\formTwo}\\
        \gN{(\forall \var . \form)} &= \forall \var . \gN{\form}\\
        \gN{(\exists \var . \form)} &= \neg \forall \var . \neg \gN{\form}
    \end{align*}
\end{definition}

\begin{theorem}
    Si tenemos $\judgC \form$, luego $\judgI \gN{\form}$
\end{theorem}

Esto significa que dada una demostración en lógica clásica, podemos obtener una
en lógica intuicionista de su traducción. Pero esto no es exactamente lo que
queremos, porque por ejemplo

\[
    \gN{(\exists x. p(x))} = \neg \forall x . \neg\neg\neg p(x)
\]

Que al no ser una demostración de un $\exists$, al reducirla no necesariamente
obtendremos un testigo.

\subsection{El truco de Friedman}

La idea de Friedman \cite{miquel-friedman} es generalizar la traducción
Gödel-Gentzen reemplazando la negación intuicionista $\neg \form \equiv A
\rightarrow \bot$ por una relativa $\negR \form \equiv \form \rightarrow R$ que
está parametrizada por una fórmula arbitraria $R$. Esto nos va a permitir, con
una elección inteligente de $R$,
traducir una demostración clásica de una fórmula $\sigmaZeroOne$ (e incluso
$\piZeroTwo$) a una intuicionista, y usarla para demostrar \textbf{la fórmula
original}. Finalmente podremos reducirla y hacer la extracción de forma usual.

\begin{definition}[Traducción de doble negación relativizada]
    \begin{align*}
        \transDNeg{\bot} &= \bot\\
        \transDNeg{\form} &= \negR\negR \form \quad \text{con $\form \neq \bot$ atómica}\\
        \transDNeg{(\form \wedge \formTwo)} &= \transDNeg{\form} \wedge \transDNeg{\formTwo}\\
        \transDNeg{(\form \vee \formTwo)} &= \negR(\negR\transDNeg{\form} \wedge \negR\transDNeg{\formTwo})\\
        \transDNeg{(\form \rightarrow \formTwo)} &= \transDNeg{\form} \rightarrow \transDNeg{\formTwo}\\
        \transDNeg{(\forall x . \form)} &= \forall x . \transDNeg{\form}\\
        \transDNeg{(\exists x . \form)} &= \negR \forall x . \negR \transDNeg{\form}
    \end{align*}
\end{definition}

\begin{theorem}
    Si $\ctx \judgC \form$, luego $\transDNeg{\ctx} \judgI \transDNeg{\form}$

    Veremos esta extensión de la traducción a contextos y demostraciones más adelante.
\end{theorem}

Veamos cómo podemos usarla para, dada una demostración clásica de $\exists \var
\form$ obtener una intuicionista.

\begin{prop}
    Sea $\someProof$ una demostración clásica de $\exists \var . \form$, y
    $\form$ una fórmula atómica.
    Si tenemos
    \[
        \ctx \judgC \exists \var . \form,
    \]
    luego
    \[
        \transDNeg{\ctx} \judgI \exists \var . \form.
    \]
\end{prop}
\begin{proof}

Aplicando la traducción, tenemos que

\begin{prooftree}
    \AxiomC{$\someProof$}
    \UnaryInfC{$\ctx \judgC \exists \var . \form$}
\end{prooftree}

se traduce a

\begin{prooftree}
    \AxiomC{$\transDNeg{\someProof}$}
    \UnaryInfC{$\transDNeg{\ctx} \judgI \negR \forall \var . \negR \negR \negR \form$}
\end{prooftree}

luego, tomando $R$ como la fórmula que queremos probar, $\exists \var . \form$

\begin{align*}
    \transDNeg{\someProof} \vartriangleright\ & \transDNeg{\ctx} \judgI \negR \forall \var . \negR \negR \negR \form\\
    \iff & \transDNeg{\ctx} \judgI \negR \forall \var . \negR \form
    &&(\fullref{lemma:tnegr-elim})\\
    =\ &\transDNeg{\ctx} \judgI (\forall \var . (\form \rightarrow R)) \rightarrow R\\
    =\ &\transDNeg{\ctx} \judgI (\forall \var . (\form \rightarrow \exists \var . \form)) \rightarrow \exists \var . \form && (R = \exists \var \form)\\
    \Rightarrow\ &\transDNeg{\ctx} \judgI \exists \var . \form && (\fullref{obs:forall-exists})
\end{align*}
\end{proof}

\begin{lemma}\label{fri:lemma:tnegr-elim}
    $\negR\negR\negR \form \iff \negR \form$
\end{lemma}
\begin{proof}
    \todo{En deducción natural}
\end{proof}

\begin{obs}\label{fri:obs:forall-exists}
    $\judgI \forall \var (\form \rightarrow \exists \var \form)$
\end{obs}

\todo{IDem pero en ND, y también para $\forall$}

\section{Normalización}

\section{Extracción de testigos}

Hacer un balance de todo lo que se mostró, pipeline